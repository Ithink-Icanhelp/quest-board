<!DOCTYPE html>
<html>
<head>
    <title>Simple Quest Board</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .card { 
            background: white; 
            color: black;
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 10px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button { 
            background: #4CAF50; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer;
            margin: 5px;
        }
        button:disabled { 
            background: #cccccc; 
            cursor: not-allowed; 
        }
        input { 
            padding: 10px; 
            width: 100%; 
            margin: 5px 0; 
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .score { 
            font-size: 2em; 
            font-weight: bold; 
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ¯ Simple Quest Board</h1>
    
    <div id="connectSection" class="card">
        <button onclick="connectWallet()">Connect Wallet</button>
    </div>

    <div id="app" style="display:none">
        <div class="card">
            <h3>Your Points: <span id="points" class="score">0</span></h3>
            <p>Connected: <span id="walletAddress"></span></p>
        </div>

        <div class="card">
            <h3>âœ… Daily Check-in</h3>
            <p>Earn 10 points every 24 hours</p>
            <button id="checkinBtn" onclick="checkIn()">Check In</button>
            <p id="checkinStatus"></p>
        </div>

        <div class="card">
            <h3>ðŸ‘¥ Add Referral</h3>
            <p>Get 50 points for each friend</p>
            <input type="text" id="referralAddress" placeholder="0x...">
            <button onclick="addReferral()">Add Referral</button>
        </div>
    </div>

    <script>
        // Ð—ÐÐœÐ•ÐÐ˜Ð¢Ð• ÐÐ ÐÐ”Ð Ð•Ð¡ Ð’ÐÐ¨Ð•Ð“Ðž ÐšÐžÐÐ¢Ð ÐÐšÐ¢Ð
        const CONTRACT_ADDRESS = "0xdB940894926DB9D7d6041a107fFBbaf311695151"; 
        const CONTRACT_ABI = [
            {
                "inputs": [],
                "name": "checkIn",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "referral", "type": "address"}
                ],
                "name": "addReferral",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getMyPoints",
                "outputs": [
                    {"internalType": "uint256", "name": "", "type": "uint256"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "canICheckIn",
                "outputs": [
                    {"internalType": "bool", "name": "", "type": "bool"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "", "type": "address"}],
                "name": "userPoints",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        let provider;
        let signer;
        let contract;

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Ð—Ð°Ð¿Ñ€Ð¾Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€ Ð¸ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°Ð½Ñ‚Ð°
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    
                    // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€ ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚Ð°
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    
                    // ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
                    document.getElementById('connectSection').style.display = 'none';
                    document.getElementById('app').style.display = 'block';
                    
                    // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ
                    updateData();
                    
                } catch (error) {
                    console.error("Error connecting:", error);
                }
            } else {
                alert("Please install MetaMask!");
            }
        }

        async function updateData() {
            if (!contract) return;
            
            try {
                const address = await signer.getAddress();
                const points = await contract.getMyPoints();
                const canCheckIn = await contract.canICheckIn();
                
                document.getElementById('points').textContent = points.toString();
                document.getElementById('walletAddress').textContent = address;
                
                const checkinBtn = document.getElementById('checkinBtn');
                const checkinStatus = document.getElementById('checkinStatus');
                
                if (canCheckIn) {
                    checkinBtn.disabled = false;
                    checkinBtn.textContent = "Check In (+10 points)";
                    checkinStatus.textContent = "Ready to check in!";
                    checkinStatus.style.color = "green";
                } else {
                    checkinBtn.disabled = true;
                    checkinBtn.textContent = "Come Back Tomorrow";
                    checkinStatus.textContent = "You already checked in today";
                    checkinStatus.style.color = "red";
                }
                
            } catch (error) {
                console.error("Error updating data:", error);
            }
        }

        async function checkIn() {
            try {
                const tx = await contract.checkIn();
                document.getElementById('checkinStatus').textContent = "Waiting for confirmation...";
                
                await tx.wait();
                document.getElementById('checkinStatus').textContent = "Check-in successful!";
                
                updateData();
                
            } catch (error) {
                console.error("Error checking in:", error);
                alert("Error: " + error.message);
            }
        }

        async function addReferral() {
            const referralAddress = document.getElementById('referralAddress').value;
            
            if (!ethers.isAddress(referralAddress)) {
                alert("Please enter a valid address");
                return;
            }
            
            try {
                const tx = await contract.addReferral(referralAddress);
                await tx.wait();
                alert("Referral added successfully!");
                document.getElementById('referralAddress').value = "";
                updateData();
                
            } catch (error) {
                console.error("Error adding referral:", error);
                alert("Error: " + error.message);
            }
        }

        // ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¸ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', () => {
                window.location.reload();
            });
        }
    </script>
    
    <!-- ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ ethers.js -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js" type="application/javascript"></script>
</body>
</html>